<!doctype html>
<html lang="zh-HK">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>投資理財計算器</title>

  <style>
    :root{
      /* 橙色背景主題 */
      --bg1:#ff6a00;
      --bg2:#ffb703;
      --bg3:#ffe08a;

      --text:#1a0c05;
      --muted: rgba(26,12,5,.70);
      --line: rgba(26,12,5,.18);

      --cardTop: rgba(255,255,255,.62);
      --cardBot: rgba(255,255,255,.40);

      --radius: 18px;
    }

    *{box-sizing:border-box;}
    body{
      margin:0;
      padding:24px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background: linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 55%, var(--bg3) 100%);
      position: relative;
      overflow-x:hidden;
    }

    /* 浮動光斑 */
    body::before{
      content:"";
      position: fixed;
      inset:-20%;
      z-index:-2;
      pointer-events:none;
      background:
        radial-gradient(900px 540px at 12% 18%, rgba(255,255,255,.35), transparent 62%),
        radial-gradient(860px 560px at 88% 22%, rgba(255,255,255,.22), transparent 58%),
        radial-gradient(780px 520px at 55% 90%, rgba(255, 94, 0, .18), transparent 62%),
        radial-gradient(1000px 700px at 55% 45%, rgba(255, 180, 0, .18), transparent 60%);
      filter: blur(6px);
      animation: bgFloat 10s ease-in-out infinite alternate;
      opacity:.9;
    }

    /* 淡網格 + 暈影 */
    body::after{
      content:"";
      position: fixed;
      inset:0;
      z-index:-1;
      pointer-events:none;
      background:
        repeating-linear-gradient(0deg, rgba(255,255,255,.25) 0 1px, transparent 1px 56px),
        repeating-linear-gradient(90deg, rgba(255,255,255,.25) 0 1px, transparent 1px 56px),
        radial-gradient(900px 600px at 50% 18%, transparent 35%, rgba(0,0,0,.18) 100%);
      opacity:.22;
      mix-blend-mode: overlay;
    }

    @keyframes bgFloat{
      from { transform: translate(-2%, -1%) scale(1.02); }
      to   { transform: translate( 2%,  1%) scale(1.06); }
    }
    @media (prefers-reduced-motion: reduce){
      body::before{ animation:none; }
    }

    /* ✅ CSS Grid：標題 / 輸入 / 輸出 / 圖表 */
    .page{
      max-width: 1120px;
      margin: 0 auto;
      display: grid;
      grid-template-areas:
        "title  title"
        "input  output"
        "chart  chart";
      grid-template-columns: 1fr 1.2fr;
      gap: 16px;
      align-items: start;
    }
    @media (max-width: 920px){
      .page{
        grid-template-areas:
          "title"
          "input"
          "output"
          "chart";
        grid-template-columns: 1fr;
      }
    }

    .title-area{ grid-area: title; }
    .input-area{ grid-area: input; }
    .output-area{ grid-area: output; }
    .chart-area{ grid-area: chart; }

    .title-card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.32));
      backdrop-filter: blur(10px);
      box-shadow: 0 14px 35px rgba(0,0,0,.16);

      display:grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      align-items: start;
    }
    @media (max-width: 720px){
      .title-card{ grid-template-columns: 1fr; }
    }

    h1{ margin:0; font-size: 28px; letter-spacing:.3px; }
    .sub{ margin:8px 0 0; color: var(--muted); line-height:1.5; }

    /* ✅ language bullets (radio) */
    .lang{
      justify-self:end;
      display:flex;
      gap:10px;
      align-items:center;
      padding:10px 12px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.45);
      user-select:none;
    }
    @media (max-width:720px){
      .lang{ justify-self:start; }
    }
    .lang label{
      display:flex;
      gap:8px;
      align-items:center;
      font-size: 13px;
      color: rgba(26,12,5,.82);
      cursor:pointer;
      white-space:nowrap;
    }
    .lang input{ accent-color: rgba(255, 94, 0, .9); }

    .card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.62), rgba(255,255,255,.40));
      backdrop-filter: blur(10px);
      box-shadow: 0 14px 35px rgba(0,0,0,.18);
    }
    .card h2{ margin:0 0 12px; font-size:18px; }

    /* Input 內部表單 Grid */
    .form-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 520px){ .form-grid{ grid-template-columns:1fr; } }

    .field{ display:grid; gap:6px; }
    label{ font-size:13px; color: var(--muted); }

    input, select{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.62);
      color: var(--text);
      outline:none;
    }
    input:focus, select:focus{
      border-color: rgba(255, 94, 0, .55);
      box-shadow: 0 0 0 3px rgba(255, 94, 0, .18);
    }
    .row-span{ grid-column: 1 / -1; }

    .actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    button{
      border:1px solid var(--line);
      background: rgba(255, 94, 0, .18);
      color: var(--text);
      padding:10px 14px;
      border-radius:12px;
      cursor:pointer;
    }
    button.secondary{ background: rgba(255,255,255,.45); }
    button:hover{ filter:brightness(1.05); }

    /* Output summary Grid */
    .stats{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 12px;
    }
    @media (max-width: 720px){ .stats{ grid-template-columns:1fr; } }

    .stat{
      border:1px solid var(--line);
      border-radius: 14px;
      padding: 12px;
      background: rgba(255,255,255,.48);
    }
    .stat .k{ font-size:12px; color: var(--muted); margin-bottom:6px; }
    .stat .v{ font-size:18px; font-weight:800; }

    .table-wrap{
      overflow:auto;
      border:1px solid var(--line);
      border-radius: 14px;
      background: rgba(255,255,255,.48);
    }
    table{ width:100%; border-collapse:collapse; min-width:780px; }
    th, td{
      padding:10px 12px;
      border-bottom:1px solid rgba(26,12,5,.14);
      text-align:right;
      white-space:nowrap;
    }
    th{
      position:sticky; top:0;
      background: rgba(255, 210, 150, .78);
      backdrop-filter: blur(10px);
      font-size:12px;
      color: rgba(26,12,5,.75);
    }
    th:first-child, td:first-child{ text-align:left; }
    tr:last-child td{ border-bottom:none; }

    .hint{ color: var(--muted); font-size:12px; margin-top:10px; line-height:1.5; }
    .warn{ color: rgba(110,40,0,.9); }

    /* 圖表區 */
    .chart-wrap{
      width:100%;
      height:320px;
      border:1px solid var(--line);
      border-radius: 14px;
      background: rgba(255,255,255,.48);
      overflow:hidden;
    }
    canvas{ width:100%; height:100%; display:block; }
  </style>
</head>

<body>
  <div class="page">
    <!-- 標題 -->
    <header class="title-area title-card">
      <div>
        <h1 id="titleText" data-i18n="title">投資理財計算器</h1>
        <p class="sub" id="subText" data-i18n="subtitle">
          輸入本金、定期定額、預期年利率、通脹率、加薪率與目標金額，即可查看每年年末資產，以及何時達到目標。
        </p>
      </div>

      <!-- ✅ bullet (radio) to switch language -->
      <div class="lang" role="group" aria-label="Language">
        <label><input type="radio" name="lang" value="zh" checked /> <span data-i18n="lang_zh">中文</span></label>
        <label><input type="radio" name="lang" value="en" /> <span data-i18n="lang_en">English</span></label>
      </div>
    </header>

    <!-- 輸入 -->
    <section class="input-area card">
      <h2 id="inputTitle" data-i18n="input_title">輸入</h2>

      <div class="form-grid">
        <div class="field">
          <label for="principal" data-i18n="label_principal">本金 ($)</label>
          <input id="principal" type="number" min="0" step="100" value="100000" />
        </div>

        <div class="field">
          <label for="contrib" data-i18n="label_contrib">每期定投金額 ($)</label>
          <input id="contrib" type="number" min="0" step="10" value="3000" />
        </div>

        <div class="field">
          <label for="freq" data-i18n="label_freq">定投頻率</label>
          <select id="freq">
            <option value="monthly" data-i18n="freq_monthly">每月</option>
            <option value="weekly" data-i18n="freq_weekly">每週</option>
            <option value="quarterly" data-i18n="freq_quarterly">每季</option>
            <option value="yearly" data-i18n="freq_yearly">每年</option>
          </select>
        </div>

        <div class="field">
          <label for="rate" data-i18n="label_rate">預期年利率 (%)</label>
          <input id="rate" type="number" step="0.01" value="7" />
        </div>

        <div class="field">
          <label for="inflation" data-i18n="label_inflation">預期通脹率 (%)</label>
          <input id="inflation" type="number" step="0.01" value="2" />
        </div>

        <div class="field">
          <label for="raise" data-i18n="label_raise">預期加薪率 (%)</label>
          <input id="raise" type="number" step="0.01" value="3" />
        </div>

        <div class="field">
          <label for="target" data-i18n="label_target">目標金額 ($)</label>
          <input id="target" type="number" min="0" step="100" value="2000000" />
        </div>

        <div class="field">
          <label for="maxYears" data-i18n="label_maxYears">最多模擬年數</label>
          <input id="maxYears" type="number" min="1" max="200" step="1" value="60" />
        </div>

        <div class="field row-span">
          <label>
            <input id="showReal" type="checkbox" checked />
            <span data-i18n="label_showReal">顯示扣除通脹後「實際購買力（Real）」欄位</span>
          </label>
        </div>
      </div>

      <div class="actions">
        <button id="calcBtn" data-i18n="btn_calc">計算</button>
        <button id="resetBtn" class="secondary" data-i18n="btn_reset">重設示例</button>
      </div>

      <div class="hint" id="inputHint" data-i18n="hint_input"></div>
    </section>

    <!-- 輸出 -->
    <section class="output-area card">
      <h2 id="outputTitle" data-i18n="output_title">輸出</h2>

      <div class="stats">
        <div class="stat">
          <div class="k" data-i18n="stat_reach">達成目標所需年份</div>
          <div class="v" id="reachYear">—</div>
        </div>
        <div class="stat">
          <div class="k" data-i18n="stat_final_nom">最後一年資產（名目 Nominal）</div>
          <div class="v" id="finalNominal">—</div>
        </div>
        <div class="stat">
          <div class="k" data-i18n="stat_final_real">最後一年資產（扣通脹 Real）</div>
          <div class="v" id="finalReal">—</div>
        </div>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th data-i18n="th_year">年份</th>
              <th data-i18n="th_nom">年末資產（Nominal $）</th>
              <th data-i18n="th_gain">相比本金升值 %</th>
              <th class="real-col" data-i18n="th_real">年末資產（Real $）</th>
              <th data-i18n="th_total">累積投入 ($)</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>

      <div class="hint warn" id="note"></div>
    </section>

    <!-- 柱狀圖（底部） -->
    <section class="chart-area card">
      <h2 id="chartTitle" data-i18n="chart_title">柱狀圖：每年年末資產（名目 Nominal）</h2>
      <div class="chart-wrap">
        <canvas id="barChart"></canvas>
      </div>
      <div class="hint" id="chartHint" data-i18n="chart_hint"></div>
    </section>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    const I18N = {
      zh: {
        html_lang: "zh-HK",
        title: "投資理財計算器",
        subtitle: "輸入本金、定期定額、預期年利率、通脹率、加薪率與目標金額，即可查看每年年末資產，以及何時達到目標。",
        lang_zh: "中文",
        lang_en: "English",

        input_title: "輸入",
        output_title: "輸出",

        label_principal: "本金 ($)",
        label_contrib: "每期定投金額 ($)",
        label_freq: "定投頻率",
        freq_monthly: "每月",
        freq_weekly: "每週",
        freq_quarterly: "每季",
        freq_yearly: "每年",

        label_rate: "預期年利率 (%)",
        label_inflation: "預期通脹率 (%)",
        label_raise: "預期加薪率 (%)",
        label_target: "目標金額 ($)",
        label_maxYears: "最多模擬年數",
        label_showReal: "顯示扣除通脹後「實際購買力（Real）」欄位",

        btn_calc: "計算",
        btn_reset: "重設示例",

        hint_input:
          "假設：每期複利（按所選頻率計算），每期結束時投入；每年的定投金額會按「加薪率」逐年增加（第 2 年開始）。<br>「相比本金升值%」＝ (年末資產 − 最初本金) / 最初本金 × 100%。",

        stat_reach: "達成目標所需年份",
        stat_final_nom: "最後一年資產（名目 Nominal）",
        stat_final_real: "最後一年資產（扣通脹 Real）",

        th_year: "年份",
        th_nom: "年末資產（Nominal $）",
        th_gain: "相比本金升值 %",
        th_real: "年末資產（Real $）",
        th_total: "累積投入 ($)",

        chart_title: "柱狀圖：每年年末資產（名目 Nominal）",
        chart_hint: "圖表預設顯示前 30 年（不足 30 年則顯示全部）。",

        yearCell: (y) => `第 ${y} 年`,
        yearLabel: (y) => `第${y}年`,

        reachedNotComputed: "提示：目標金額為 0 或空白，所以不計算「達成目標所需年份」。",
        notReached: (maxYears) => `在最多 ${maxYears} 年內未達到目標。可嘗試提高定投/利率，或延長年期。`,
        reachPrefix: (y, approx) => `第 ${y} 年 ${approx}`,

        approx_monthly: (Y, P) => `（約 ${Y} 年 ${P} 個月）`,
        approx_weekly: (Y, P) => `（約 ${Y} 年 ${P} 週）`,
        approx_quarterly: (Y, P) => `（約 ${Y} 年 ${P} 季）`,
        approx_yearly: (Y) => `（約 ${Y} 年後）`,

        hidden: "（已隱藏）",
        notReachedWord: "未達成",
        locale: "zh-HK"
      },

      en: {
        html_lang: "en",
        title: "Investment & Finance Calculator",
        subtitle: "Enter your principal, recurring contributions, expected return, inflation, salary growth, and target amount. See the year-end balance and when you reach the goal.",
        lang_zh: "中文",
        lang_en: "English",

        input_title: "Inputs",
        output_title: "Outputs",

        label_principal: "Principal ($)",
        label_contrib: "Contribution per period ($)",
        label_freq: "Contribution frequency",
        freq_monthly: "Monthly",
        freq_weekly: "Weekly",
        freq_quarterly: "Quarterly",
        freq_yearly: "Yearly",

        label_rate: "Expected annual return (%)",
        label_inflation: "Expected inflation (%)",
        label_raise: "Expected salary growth (%)",
        label_target: "Target amount ($)",
        label_maxYears: "Max years to simulate",
        label_showReal: "Show inflation-adjusted “Real” column",

        btn_calc: "Calculate",
        btn_reset: "Reset example",

        hint_input:
          "Assumptions: compounding occurs each period (based on frequency), contributions are made at the end of each period, and contributions increase annually by the salary growth rate (starting in year 2).<br>“Gain vs principal %” = (year-end balance − initial principal) / initial principal × 100%.",

        stat_reach: "Years to reach target",
        stat_final_nom: "Final year balance (Nominal)",
        stat_final_real: "Final year balance (Real)",

        th_year: "Year",
        th_nom: "Year-end balance (Nominal $)",
        th_gain: "Gain vs principal %",
        th_real: "Year-end balance (Real $)",
        th_total: "Total contributed ($)",

        chart_title: "Bar Chart: Year-end Balance (Nominal)",
        chart_hint: "Chart shows the first 30 years by default (or fewer if you simulate less).",

        yearCell: (y) => `Year ${y}`,
        yearLabel: (y) => `Y${y}`,

        reachedNotComputed: "Tip: Target amount is 0 or empty, so “years to target” is not computed.",
        notReached: (maxYears) => `Target not reached within ${maxYears} years. Try increasing contributions/return, or extend the years.`,
        reachPrefix: (y, approx) => `Year ${y} ${approx}`,

        approx_monthly: (Y, P) => `(approx. ${Y} years ${P} months)`,
        approx_weekly: (Y, P) => `(approx. ${Y} years ${P} weeks)`,
        approx_quarterly: (Y, P) => `(approx. ${Y} years ${P} quarters)`,
        approx_yearly: (Y) => `(approx. after ${Y} years)`,

        hidden: "(hidden)",
        notReachedWord: "Not reached",
        locale: "en-US"
      }
    };

    let currentLang = "zh";
    let lastRows = [];
    let resizeTimer = null;

    function applyI18n(lang){
      currentLang = lang;
      const t = I18N[currentLang];

      document.documentElement.lang = t.html_lang;
      document.title = t.title;

      // text nodes
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        const val = t[key];
        if (typeof val === "string") el.textContent = val;
      });

      // hint uses HTML (<br>)
      $("inputHint").innerHTML = t.hint_input;
      $("chartHint").textContent = t.chart_hint;

      // update table/chart with new language
      calculate();
    }

    function fmtMoney(x){
      if (!isFinite(x)) return "—";
      return x.toLocaleString(I18N[currentLang].locale, { maximumFractionDigits: 0 });
    }
    function fmtPct(x){
      if (!isFinite(x)) return "—";
      return x.toLocaleString(I18N[currentLang].locale, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + "%";
    }

    function periodsPerYear(freq){
      switch(freq){
        case "weekly": return 52;
        case "monthly": return 12;
        case "quarterly": return 4;
        case "yearly": return 1;
        default: return 12;
      }
    }

    function niceMax(maxVal){
      if (!isFinite(maxVal) || maxVal <= 0) return 1;
      const exp = Math.floor(Math.log10(maxVal));
      const base = Math.pow(10, exp);
      const m = maxVal / base;
      let nice;
      if (m <= 1) nice = 1;
      else if (m <= 2) nice = 2;
      else if (m <= 5) nice = 5;
      else nice = 10;
      return nice * base;
    }

    function formatShort(n){
      if (!isFinite(n)) return "";
      if (n >= 1e9) return (n/1e9).toFixed(1) + "B";
      if (n >= 1e6) return (n/1e6).toFixed(1) + "M";
      if (n >= 1e3) return (n/1e3).toFixed(1) + "K";
      return Math.round(n).toString();
    }

    function drawBarChart(rows){
      const canvas = $("barChart");
      if (!canvas) return;

      const showYears = Math.min(rows.length, 30);
      const data = rows.slice(0, showYears);

      const t = I18N[currentLang];
      const labels = data.map(r => t.yearLabel(r.year));
      const values = data.map(r => r.nominal);
      const maxV = Math.max(...values, 1);
      const yMax = niceMax(maxV * 1.05);

      const ctx = canvas.getContext("2d");

      // DPR for crispness
      const dpr = window.devicePixelRatio || 1;
      const cssW = canvas.clientWidth;
      const cssH = canvas.clientHeight;
      canvas.width = Math.round(cssW * dpr);
      canvas.height = Math.round(cssH * dpr);
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

      ctx.clearRect(0, 0, cssW, cssH);

      const padL = 56, padR = 16, padT = 18, padB = 44;
      const w = cssW - padL - padR;
      const h = cssH - padT - padB;

      // grid + y labels
      ctx.font = "12px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif";
      ctx.fillStyle = "rgba(26,12,5,.70)";
      ctx.strokeStyle = "rgba(26,12,5,.18)";
      ctx.lineWidth = 1;

      const ticks = 5;
      for (let i = 0; i <= ticks; i++){
        const y = padT + h - (i / ticks) * h;
        ctx.beginPath();
        ctx.moveTo(padL, y);
        ctx.lineTo(padL + w, y);
        ctx.stroke();

        const v = (i / ticks) * yMax;
        ctx.fillText(formatShort(v), 8, y + 4);
      }

      // bars
      const n = values.length;
      const gap = Math.max(3, Math.min(10, w / (n * 4)));
      const barW = (w - gap * (n - 1)) / n;

      for (let i = 0; i < n; i++){
        const val = values[i];
        const barH = (val / yMax) * h;
        const x = padL + i * (barW + gap);
        const y = padT + h - barH;

        ctx.fillStyle = "rgba(255, 94, 0, .62)";
        ctx.fillRect(x, y, barW, barH);

        ctx.strokeStyle = "rgba(26,12,5,.25)";
        ctx.strokeRect(x, y, barW, barH);
      }

      // axes
      ctx.strokeStyle = "rgba(26,12,5,.35)";
      ctx.beginPath();
      ctx.moveTo(padL, padT);
      ctx.lineTo(padL, padT + h);
      ctx.lineTo(padL + w, padT + h);
      ctx.stroke();

      // x labels (~10 max)
      const step = Math.max(1, Math.ceil(n / 10));
      ctx.fillStyle = "rgba(26,12,5,.70)";
      for (let i = 0; i < n; i += step){
        const x = padL + i * (barW + gap) + barW / 2;
        const y = padT + h + 28;

        ctx.save();
        ctx.translate(x, y);
        ctx.rotate(-Math.PI / 6);
        ctx.textAlign = "right";
        ctx.fillText(labels[i], 0, 0);
        ctx.restore();
      }
    }

    function approxText(freq, fullYears, remPeriods){
      const t = I18N[currentLang];
      if (freq === "monthly") return t.approx_monthly(fullYears, remPeriods);
      if (freq === "weekly") return t.approx_weekly(fullYears, remPeriods);
      if (freq === "quarterly") return t.approx_quarterly(fullYears, remPeriods);
      return t.approx_yearly(fullYears);
    }

    function calculate(){
      const principal = parseFloat($("principal").value) || 0;
      const contribBase = parseFloat($("contrib").value) || 0;
      const freq = $("freq").value;
      const r = (parseFloat($("rate").value) || 0) / 100;
      const inf = (parseFloat($("inflation").value) || 0) / 100;
      const raise = (parseFloat($("raise").value) || 0) / 100;
      const target = parseFloat($("target").value) || 0;
      const maxYears = Math.max(1, Math.min(200, parseInt($("maxYears").value || "60", 10)));
      const showReal = $("showReal").checked;

      document.querySelectorAll(".real-col").forEach(el => {
        el.style.display = showReal ? "" : "none";
      });

      const n = periodsPerYear(freq);
      const rp = Math.pow(1 + r, 1 / n) - 1;

      let balance = principal;
      let totalContrib = principal;

      let reachedYear = null;
      let reachedAtPeriods = null;

      const rows = [];
      let periodCount = 0;

      for (let year = 1; year <= maxYears; year++){
        const yearContribFactor = Math.pow(1 + raise, year - 1);
        const contribPerPeriod = contribBase * yearContribFactor;

        for (let p = 1; p <= n; p++){
          balance *= (1 + rp);
          balance += contribPerPeriod;
          totalContrib += contribPerPeriod;

          periodCount++;
          if (reachedAtPeriods === null && target > 0 && balance >= target){
            reachedAtPeriods = periodCount;
            reachedYear = year;
          }
        }

        const nominal = balance;
        const real = nominal / Math.pow(1 + inf, year);
        const gainPct = (principal > 0) ? ((nominal - principal) / principal * 100) : NaN;

        rows.push({ year, nominal, gainPct, real, totalContrib });
      }

      const t = I18N[currentLang];

      $("tbody").innerHTML = rows.map(rw => `
        <tr>
          <td>${t.yearCell(rw.year)}</td>
          <td>${fmtMoney(rw.nominal)}</td>
          <td>${fmtPct(rw.gainPct)}</td>
          <td class="real-col" style="display:${showReal ? "" : "none"}">${fmtMoney(rw.real)}</td>
          <td>${fmtMoney(rw.totalContrib)}</td>
        </tr>
      `).join("");

      const last = rows[rows.length - 1];
      $("finalNominal").textContent = "$ " + fmtMoney(last.nominal);
      $("finalReal").textContent = showReal ? ("$ " + fmtMoney(last.real)) : t.hidden;

      const note = $("note");
      if (target <= 0){
        $("reachYear").textContent = "—";
        note.textContent = t.reachedNotComputed;
      } else if (reachedYear === null){
        $("reachYear").textContent = t.notReachedWord;
        note.textContent = t.notReached(maxYears);
      } else {
        const fullYears = Math.floor((reachedAtPeriods - 1) / n);
        const remPeriods = (reachedAtPeriods - 1) % n;
        const approx = approxText(freq, fullYears, remPeriods);

        $("reachYear").textContent = t.reachPrefix(reachedYear, approx);
        note.textContent = "";
      }

      // update chart
      lastRows = rows;
      drawBarChart(lastRows);
    }

    // Buttons
    $("calcBtn").addEventListener("click", calculate);
    $("resetBtn").addEventListener("click", () => {
      $("principal").value = 100000;
      $("contrib").value = 3000;
      $("freq").value = "monthly";
      $("rate").value = 7;
      $("inflation").value = 2;
      $("raise").value = 3;
      $("target").value = 2000000;
      $("maxYears").value = 60;
      $("showReal").checked = true;
      calculate();
    });

    // Resize chart
    window.addEventListener("resize", () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => drawBarChart(lastRows), 120);
    });

    // Language bullets
    document.querySelectorAll('input[name="lang"]').forEach(radio => {
      radio.addEventListener("change", (e) => applyI18n(e.target.value));
    });

    // init
    applyI18n("zh");
  </script>
</body>
</html>
